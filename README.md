# Скрипт для добавления и изменения имени пользователя по API в WGDashboard

## Описание проекта
Данный скрипт предназначен для автоматизации процесса добавления и изменения имени пользователя через API в системе WGDashboard. Скрипт обеспечивает безопасное и эффективное взаимодействие с API, позволяя выполнять операции с данными пользователей.

## План действий

### Разработка основного функционала
- [x] Реализовать авторизацию в API
- [x] Разработать функцию добавления нового пользователя
- [x] Разработать функцию изменения имени существующего пользователя
    - [ ] Уникальное имя на входе (к примеру ID в TG)
    - [ ] Проработать логику замены более одного имени
    - [ ] Одно из имен должно иметь приписку _Mobile
- [x] Реализовать обработку ошибок и исключений
    - [ ] Логирование в отдельный файл
    - [ ] Другие возможные обработки ошибок
    - [x] Частичная обработка ошибок
- [x] Необходимо разобраться в исходнике, для управления наименованием конфигурации
- [ ] Добавить список allowed_ip

### Тестирование
- [ ] Написать модульные тесты
- [ ] Выполнить интеграционное тестирование
- [x] Провести тестирование на реальных данных

### Документация
- [x] Дополнить документацию по использованию скрипта
- [x] Подготовить примеры использования

## Планы на будущее
- [ ] Добавить удаление пользователей
   - [ ] Неактивных пользователей в течении N кол-во времени
   - [ ] Конкретного пользователя
- [ ] Написать TG бота и добавить в связку с ним
- [ ] Видел возможность добавлять разные действия к Peer - к примеру на трафик. Можно рассмотреть вариант добавления действия по времени пользователя. К примеру месяц.


## Установка и настройка

### Предварительные требования
* Доступ к API WGDashboard
* Установленный WGDashboard (см. [официальный репозиторий](https://github.com/donaldzou/WGDashboard))


##  Использование

### Пример команды запуска
```bash
./create_wg_users.py --api_key "Ваш ключ" --config_name "Название интерфейса" --ip "ip адрес" --port "Порт на котором развернут" -a "Кол-во пользователей" -n "Название пира"
```

### Параметры
| Параметр              | Описание                                                    |
|-----------------------|-------------------------------------------------------------|
| `--api_key`, `-k`     | Ключ API для доступа к WGDashboard                          |
| `--config_name`, `-c` | Имя конфигурации WireGuard (например, wg0)                  |
| `--ip`, `-i`          | IP-адрес сервера с WGDashboard                              |
| `--port`, `-p`        | Порт WGDashboard                                            |
| `--amount`, `-a`      | Действие (например, "1" для добавления нового пользователя) |
| `--name_user`,  `-n`  | Имя пользователя                                            |
| `--dns`, `-d`         | DNS сервер                                                  |
| `--mtu`, `-m`         | MTU                                                         |
| `--keepalive`, `-l`   | Keepalive                                                   |


## Примечания по интеграции с WGDashboard

Для корректной работы скрипта в репозитории WGDashboard необходимо внести изменения в файл `dashboard.py`. 
В функции `API_addPeers(configName)` добавлен возврат имени:

```python
return ResponseObject(data=[{"name": peer["name"]} for peer in keyPairs])
```

Это позволяет избежать дополнительного запроса на `/api/getWireguardConfigurationInfo`, сортировки имени по названию и т.д.




